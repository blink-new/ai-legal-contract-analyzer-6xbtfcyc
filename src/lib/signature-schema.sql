-- Signature Documents Table\nCREATE TABLE IF NOT EXISTS signature_documents (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  content TEXT NOT NULL, -- Base64 or URL\n  type TEXT NOT NULL CHECK (type IN ('pdf', 'word', 'image')),\n  pages INTEGER NOT NULL DEFAULT 1,\n  routing TEXT NOT NULL CHECK (routing IN ('sequential', 'parallel')) DEFAULT 'sequential',\n  status TEXT NOT NULL CHECK (status IN ('draft', 'sent', 'in_progress', 'completed', 'declined', 'expired')) DEFAULT 'draft',\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  completed_at DATETIME,\n  user_id TEXT NOT NULL,\n  contract_id TEXT, -- Link to original contract\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\n-- Signature Fields Table\nCREATE TABLE IF NOT EXISTS signature_fields (\n  id TEXT PRIMARY KEY,\n  document_id TEXT NOT NULL,\n  type TEXT NOT NULL CHECK (type IN ('signature', 'initials', 'name', 'date', 'title', 'checkbox', 'radio', 'textbox')),\n  x REAL NOT NULL,\n  y REAL NOT NULL,\n  width REAL NOT NULL,\n  height REAL NOT NULL,\n  page INTEGER NOT NULL DEFAULT 1,\n  required INTEGER NOT NULL DEFAULT 1, -- SQLite boolean as integer\n  label TEXT NOT NULL,\n  value TEXT,\n  options TEXT, -- JSON array for radio buttons\n  recipient_id TEXT,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (document_id) REFERENCES signature_documents(id) ON DELETE CASCADE,\n  FOREIGN KEY (recipient_id) REFERENCES signature_recipients(id)\n);\n\n-- Signature Recipients Table\nCREATE TABLE IF NOT EXISTS signature_recipients (\n  id TEXT PRIMARY KEY,\n  document_id TEXT NOT NULL,\n  email TEXT NOT NULL,\n  name TEXT NOT NULL,\n  role TEXT NOT NULL CHECK (role IN ('signer', 'approver', 'viewer', 'certified_recipient', 'in_person_signer')),\n  auth_method TEXT NOT NULL CHECK (auth_method IN ('email', 'sms', 'access_code', 'id_verification')) DEFAULT 'email',\n  notes TEXT,\n  status TEXT NOT NULL CHECK (status IN ('pending', 'viewed', 'signed', 'declined', 'completed')) DEFAULT 'pending',\n  signed_at DATETIME,\n  ip_address TEXT,\n  order_index INTEGER NOT NULL DEFAULT 0,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (document_id) REFERENCES signature_documents(id) ON DELETE CASCADE\n);\n\n-- Audit Trail Table\nCREATE TABLE IF NOT EXISTS signature_audit_trail (\n  id TEXT PRIMARY KEY,\n  document_id TEXT NOT NULL,\n  timestamp DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  action TEXT NOT NULL,\n  user_id TEXT,\n  recipient_id TEXT,\n  ip_address TEXT NOT NULL,\n  user_agent TEXT,\n  details TEXT, -- JSON object\n  FOREIGN KEY (document_id) REFERENCES signature_documents(id) ON DELETE CASCADE,\n  FOREIGN KEY (recipient_id) REFERENCES signature_recipients(id)\n);\n\n-- Signature Templates Table\nCREATE TABLE IF NOT EXISTS signature_templates (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  description TEXT,\n  fields TEXT NOT NULL, -- JSON array of field definitions\n  recipients TEXT NOT NULL, -- JSON array of recipient definitions\n  routing TEXT NOT NULL CHECK (routing IN ('sequential', 'parallel')) DEFAULT 'sequential',\n  user_id TEXT NOT NULL,\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\n-- Signing Sessions Table\nCREATE TABLE IF NOT EXISTS signing_sessions (\n  id TEXT PRIMARY KEY,\n  document_id TEXT NOT NULL,\n  recipient_id TEXT NOT NULL,\n  access_token TEXT NOT NULL UNIQUE,\n  expires_at DATETIME NOT NULL,\n  current_page INTEGER NOT NULL DEFAULT 1,\n  completed_fields TEXT, -- JSON array of completed field IDs\n  status TEXT NOT NULL CHECK (status IN ('active', 'completed', 'expired')) DEFAULT 'active',\n  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (document_id) REFERENCES signature_documents(id) ON DELETE CASCADE,\n  FOREIGN KEY (recipient_id) REFERENCES signature_recipients(id) ON DELETE CASCADE\n);\n\n-- Indexes for better performance\nCREATE INDEX IF NOT EXISTS idx_signature_documents_user_id ON signature_documents(user_id);\nCREATE INDEX IF NOT EXISTS idx_signature_documents_status ON signature_documents(status);\nCREATE INDEX IF NOT EXISTS idx_signature_fields_document_id ON signature_fields(document_id);\nCREATE INDEX IF NOT EXISTS idx_signature_recipients_document_id ON signature_recipients(document_id);\nCREATE INDEX IF NOT EXISTS idx_signature_recipients_email ON signature_recipients(email);\nCREATE INDEX IF NOT EXISTS idx_signature_audit_document_id ON signature_audit_trail(document_id);\nCREATE INDEX IF NOT EXISTS idx_signing_sessions_token ON signing_sessions(access_token);\nCREATE INDEX IF NOT EXISTS idx_signing_sessions_expires ON signing_sessions(expires_at);"